# DNS

ドメイン取得からVPSで使えるようにするまで。

## 概要

DNSを取得して使える状態にする

BIND（DNSサーバー）の設定知識はあるに越したことはないものの、DNSサーバーの運用は慣れてからでも良いのでとりあえず無料のDNSを利用する。

## ステップ

1. ドメインの取得
2. ドメインのネームサーバー（DNSサーバー）を登録
3. DNSの設定

ドメイン取得の流れでネームサーバーをどうするか聞かれるので、先にGEHIRN DNS（2ドメインまで無料のDNSサービス）でアカウント登録を済ませ、ドメイン登録画面を開いておくと捗る。

## ドメインの取得

http://muumuu-domain.com/

安い

簡易なDNSも提供されているがワイルドカードが使えない上TTLも指定できないのでおすすめできない。

GEHIRN DNSを利用する場合は`ns.gehirn.jp`など4つのネームサーバーを登録する。

GEHIRN の管理画面上で4つのネームサーバー登録を求められるので、この画面まで進めておく。

ネームサーバーの登録がルートサーバに反映されるまでしばらくかかる。

	$ dig example.com NS
	$ whois example.com

上記のコマンドでネームサーバーの登録を確認できる。

## DNS設定

http://www.gehirn.jp/dns.html

2ドメインまで無料、ワイルドカード対応、TTLも短くできる。

	example.com => XXX.XXX.XXX.XXX
	*.example.com => XXX.XXX.XXX.XXX

とりあえずサブドメインなしと、1階層のサブドメイン全てをVPSのグローバルIPに割り当てておけばだいたい事足りる。

blog.example.comだけTumblrで利用したいなどの場合でも、後から追加設定できる。

## TTLとは

DNS索引を結果をキャッシュしてもらう時間で秒単位で設定する、通常1日〜短くても1時間を設定する。

短すぎるとDNSサーバーに対しての問い合わせが増え、DNSサーバーの負荷が増す。

サーバーの移転（IPが変わる）を行う場合、あらかじめTTLを10分など短く設定しておき、当日の移転時のDNS変更がなるべく早く反映されるように工夫する。

しかし、TTLの値に関係なくキャッシュを長期間持つDNSサーバーや、古いIPに接続してくるクライアントもいる。

作業前に短く設定したTTLは、新しいIPに変更後TTLも平時の値に戻すのを忘れずに。

## ワイルドカードとは

foo.example.com や hoge.example.com など、サブドメインをまとめて同じIPに割り当てたい場合に利用する。

ドメインには階層があり、*.example.com という指定だけでなく *.www.example.com という様に深い階層を作ることもできる。

ワイルドカードは階層毎に設定する、*.example.com（1階層）の指定はexample.com（0階層）やfoo.hoge.example.com（2階層）には影響しない。

サブドメインをうまく利用すると1つのドメインで色々なサービスが運用できる。

## その他

今設定したのはAレコードと呼ばれるホストのIPアドレスを登録するもので、この他にメールサーバーを指定するMXレコード、外部のサービスで自分のドメインを利用する際などに使用するCNAMEレコード、Google Analyticsなどで自分がドメイン所有者である事の確認などで利用するTXTレコードなどがある、これらは必要に応じて解説します。





